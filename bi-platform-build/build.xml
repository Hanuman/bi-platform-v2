<!-- 
		This file is used by release engineering to build and publish Open BI Platform artifacts.
     	Please do not edit this file for use in a development environment.   Use dev_build.xml instead.
-->

<project name="Pentaho BI Platform Open Build" basedir="." default="all">

	<property file="override.properties" />
	<property file="build.properties" />

	<property name="publishTo" value="publish-local" />
	
	<import file="common.xml" />

	<!--=======================================================================
        set-build.id
    
        Sets a property build.id to the either "development" or the svn revision
        if in release mode
        ====================================================================-->
	<target name="set-build.id" unless="build.id" depends="install-antcontrib">
		<if>
			<istrue value="${release}" />
			<then>
				<antcallback target="svn-revision" return="svn.revision" />
				<property name="build.id" value="${svn.revision}" />
			</then>
			<else>
				<property name="build.id" value="development" />
			</else>
		</if>
	</target>


	<!--=======================================================================
        all
    
        cleans, resolves and publishes and generates javadoc for all platform 
        projects serially by order of dependency.
        Note: the release process depends on this target working this way, please
        talk to the release manager if you need to change this target.
        ====================================================================-->	
	
	<target name="all" depends="install-antcontrib" description="cleans, resolves, publishes and generates javadoc for all platform projects serially">
			<sequential>
			  	<property name="bi.javadoc.list" value="bi-platform-api,
			  											bi-platform-util,
			  											bi-platform-engine-core,
			  											bi-platform-test-foundation,
			  											bi-platform-engine-security,
			  											bi-platform-engine-services,
			  											bi-platform-repository,
			  											bi-platform-ui-foundation,
			  											bi-platform-plugin-services,
			  											bi-platform-plugin-actions,
			  											bi-platform-scheduler,
			  											bi-platform-legacy,
			  											bi-platform-web,
			  											bi-platform-web-servlet,
			  											bi-platform-web-portlet,
			  	                                        bi-platform-security-userroledao,
	  	  												mantle"/>
				<for list="${bi.javadoc.list}" param="module" trim="true">
					<sequential>
						<ant antfile="build.xml" dir="../@{module}">
							<target name="clean-all" />
							<target name="resolve" />
						    <target name="dist-javadoc" />
							<target name="${publishTo}" />
						</ant>
					</sequential>
				</for>
		      <ant antfile="build.xml" dir="../bi-platform-sample-data">
		        <target name="${publishTo}" />
		      </ant>
			</sequential>
		</target>
</project>