<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.pentaho.platform.engine.security.userroledao">

  <class name="PentahoUser" table="USERS">
    <id access="field" name="username" column="USERNAME" type="string" length="50">
      <generator class="assigned" />
    </id>
    <property name="password" column="PASSWORD" type="string" length="50" not-null="true" />
    <property name="description" column="DESCRIPTION" type="string" length="100" not-null="false" />
    <property name="enabled" column="ENABLED" type="boolean" not-null="true" />
    <set name="roles" table="GRANTED_AUTHORITIES" order-by="AUTHORITY">
      <key column="USERNAME" />
      <many-to-many column="AUTHORITY" class="PentahoRole" />
    </set>
  </class>

  <class name="PentahoRole" table="AUTHORITIES">
    <id access="field" name="name" column="AUTHORITY" type="string" length="50">
      <generator class="assigned" />
    </id>
    <property name="description" column="DESCRIPTION" type="string" length="100" not-null="false" />
    <!--
      inverse="true" means that any users added to a role's users set will not be persisted; instead, you must persist
      by editing the other direction (i.e. add a role to the user object)
    -->
    <set name="users" table="GRANTED_AUTHORITIES" inverse="true" order-by="USERNAME">
      <key column="AUTHORITY" />
      <many-to-many column="USERNAME" class="PentahoUser" />
    </set>
  </class>

</hibernate-mapping>