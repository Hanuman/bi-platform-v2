<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
  "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
  <!-- JNDI environment variable -->
  <bean id="environment" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
    <property name="properties">
      <props>
    	  <prop key="java.naming.security.authentication">simple</prop>
    	  <!-- out of the box manager user and password -->
    	  <prop key="java.naming.security.principal">uid=admin,ou=system</prop>
          <prop key="java.naming.security.credentials">secret</prop>
      </props>
    </property>
  </bean>
  
  <!-- StartupConfiguration to start ApacheDS -->
<bean id="configuration" class="org.apache.directory.server.configuration.MutableServerStartupConfiguration">
    <!-- workingDirectory is set programmatically using java.io.tmpdir -->
    <property name="allowAnonymousAccess"><value>false</value></property>
    <property name="accessControlEnabled"><value>false</value></property>
    <property name="ldapPort"><value>10389</value></property>
    <property name="contextPartitionConfigurations">
      <set>
        <ref bean="apachePartitionConfiguration"/>
      </set>
    </property>

    <!-- Bootstrap schemas -->
    <property name="bootstrapSchemas">
      <set>
        <bean class="org.apache.directory.server.core.schema.bootstrap.CoreSchema"/>
        <bean class="org.apache.directory.server.core.schema.bootstrap.CosineSchema"/>
        <bean class="org.apache.directory.server.core.schema.bootstrap.ApacheSchema"/>
        <bean class="org.apache.directory.server.core.schema.bootstrap.CollectiveSchema"/>
        <bean class="org.apache.directory.server.core.schema.bootstrap.InetorgpersonSchema"/>
        <bean class="org.apache.directory.server.core.schema.bootstrap.SystemSchema"/>
      </set>
    </property>
    
    <!-- Interceptor configurations -->
    <property name="interceptorConfigurations">
      <list>
<bean class="org.apache.directory.server.core.configuration.MutableInterceptorConfiguration">
          <property name="name"><value>normalizationService</value></property>
          <property name="interceptor">
            <bean class="org.apache.directory.server.core.normalization.NormalizationService" />
          </property>
        </bean>
<bean class="org.apache.directory.server.core.configuration.MutableInterceptorConfiguration">
          <property name="name"><value>authenticationService</value></property>
          <property name="interceptor">
            <bean class="org.apache.directory.server.core.authn.AuthenticationService" />
          </property>
        </bean>
<bean class="org.apache.directory.server.core.configuration.MutableInterceptorConfiguration">
          <property name="name"><value>authorizationService</value></property>
          <property name="interceptor">
            <bean class="org.apache.directory.server.core.authz.AuthorizationService" />
          </property>
        </bean>
      </list>
    </property>
  </bean>

  <!-- Additional ContextPartitionConfiguration -->
  <bean id="apachePartitionConfiguration" class="org.apache.directory.server.core.configuration.MutablePartitionConfiguration">
    <property name="name"><value>acegisecurity</value></property>
    <property name="suffix"><value>dc=acegisecurity,dc=org</value></property>
    <property name="indexedAttributes">
      <set>
        <value>objectClass</value>
        <value>ou</value>
        <value>uid</value>
        <value>cn</value>
        <value>member</value>
      </set>
    </property>
    <property name="contextEntry">
      <value>
        objectClass: top
        objectClass: domain
        objectClass: extensibleObject
        dc: acegisecurity
      </value>
    </property>
  </bean>

  <!-- Custom editors required to launch ApacheDS -->
  <bean class="org.springframework.beans.factory.config.CustomEditorConfigurer">
    <property name="customEditors">
      <map>
        <entry key="javax.naming.directory.Attributes">
          <bean class="org.apache.directory.server.core.configuration.AttributesPropertyEditor"/>
        </entry>
      </map>
   </property>
  </bean>
</beans>